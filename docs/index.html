<!DOCTYPE html>
<html>
	<head>
		<title>Calendar &bullet; 0.0.1</title>
		<meta charset="utf-8">
		<meta http-equiv="x-ua-compatible" content="ie=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- MomentJS -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.18.1/moment-with-locales.min.js"></script>
		<!-- Lodash -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.4/lodash.min.js"></script>
		<!-- jQuery -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
		<!-- Semantic UI -->
		<link href="http://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.11/semantic.css" rel="stylesheet">
		<script src="https://cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.2.11/semantic.min.js"></script>
		<!-- Lato -->
		<link href="https://fonts.googleapis.com/css?family=Lato:100,100i,300,300i,400,400i,700,700i,900,900i&amp;subset=latin-ext" rel="stylesheet">
		<!-- OpenSans -->
		<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i&amp;subset=cyrillic,cyrillic-ext,greek,greek-ext,latin-ext,vietnamese" rel="stylesheet">
		<!-- Calendar -->
		<style>
			/* Calendar */
			html, body,
			#calendar { width: 100%; height: 100%; overflow: hidden; }
			#calendar > nav { height: 50px; display: flex; justify-content: center; align-items: center; }
			#calendar > nav > .nav { height: 50px; width: 50px; padding: 5px; }
			#calendar > nav > .nav.hide { position: absolute; left: 0; top: 0; }
			#calendar > nav > .nav svg { fill: #777777; }
			#calendar > nav > .nav:hover svg { fill: #000000; }
			#calendar > nav > .title { color: #666666; font-weight: 300; font-size: 25px; line-height: 25px; text-align: center; letter-spacing: -1px; position: relative; }
			#calendar > nav > .title strong { font-weight: 800; }
				/* Calendar: Year */
				#calendar > .YYYY { position: absolute; width: 100%; left: 0; top: 50px; bottom: 10px; }
					/* Calendar: Months */
					#calendar > .YYYY > .M { float: left; width: calc((100% - 50px) / 4); margin-left: 10px; text-align: center; }
						/* Calendar: Rows */
						#calendar > .YYYY[data-w="16"] > .M[data-w="4"] { height: calc(100%/16*4); }
						#calendar > .YYYY[data-w="16"] > .M[data-w="5"] { height: calc(100%/16*5); }
						#calendar > .YYYY[data-w="16"] > .M[data-w="6"] { height: calc(100%/16*6); }
						#calendar > .YYYY[data-w="17"] > .M[data-w="4"] { height: calc(100%/17*4); }
						#calendar > .YYYY[data-w="17"] > .M[data-w="5"] { height: calc(100%/17*5); }
						#calendar > .YYYY[data-w="17"] > .M[data-w="6"] { height: calc(100%/17*6); }
						#calendar > .YYYY[data-w="18"] > .M[data-w="4"] { height: calc(100%/18*4); }
						#calendar > .YYYY[data-w="18"] > .M[data-w="5"] { height: calc(100%/18*5); }
						#calendar > .YYYY[data-w="18"] > .M[data-w="6"] { height: calc(100%/18*6); }
							/* Calendar: Month-names */
							#calendar > .YYYY > .M > .MMMM { color: #444444; font-weight: 700; line-height: 1.5em; text-transform: uppercase; text-align: center; }
							#calendar > .YYYY > .M > .ddd { font-size: 10px; font-weight: 700; line-height: 2em; text-transform: uppercase; text-align: center; width: calc(100%/7); float: left; }
							#calendar > .YYYY > .M > .ddd:before { content: attr(data-ddd); }
								/* Calendar: Days */
								#calendar > .YYYY > .M > .MM { clear: both; width: 100%; height: calc(100% - 3.5em); }
								#calendar > .YYYY > .M[data-w="4"] > .MM > .D { height: calc((100% + 3px) / 4); }
								#calendar > .YYYY > .M[data-w="5"] > .MM > .D { height: calc((100% + 4px) / 5); }
								#calendar > .YYYY > .M[data-w="6"] > .MM > .D { height: calc((100% + 5px) / 6); }
								#calendar > .YYYY > .M > .MM > .D { float: left; width: calc((100% + 6px) / 7); position: relative; border: 1px solid #DEDEDE; margin-right: -1px; margin-bottom: -1px; position: relative; display: flex; align-items: center; justify-content: center; color: #333333; background: #FFFFFF; text-decoration: none; }
								#calendar > .YYYY > .M > .MM > .D.active { font-weight: bold; background: #32358F; color: #FFFFFF; box-shadow: inset 1px 0px 0px #FFFFFF, inset -1px 0px 0px #FFFFFF, inset 0px -1px 0px #FFFFFF, inset 0px 1px 0px #FFFFFF; }
								#calendar > .YYYY > .M > .MM > .D:first-child[data-d="1"] { margin-left: calc(((100% + 6px) / 7) * 1 - 1px); }
								#calendar > .YYYY > .M > .MM > .D:first-child[data-d="2"] { margin-left: calc(((100% + 6px) / 7) * 2 - 2px); }
								#calendar > .YYYY > .M > .MM > .D:first-child[data-d="3"] { margin-left: calc(((100% + 6px) / 7) * 3 - 3px); }
								#calendar > .YYYY > .M > .MM > .D:first-child[data-d="4"] { margin-left: calc(((100% + 6px) / 7) * 4 - 4px); }
								#calendar > .YYYY > .M > .MM > .D:first-child[data-d="5"] { margin-left: calc(((100% + 6px) / 7) * 5 - 5px); }
								#calendar > .YYYY > .M > .MM > .D:first-child[data-d="6"] { margin-left: calc(((100% + 6px) / 7) * 6 - 6px); }
								#calendar > .YYYY > .M > .MM > .D > .num { position: absolute; font-size: 11px; top: 0px; left: 4px; }
								#calendar > .YYYY > .M > .MM > .D:hover > .num { font-weight: 700; }
								.member { margin: 7px 3px !important; }
								.D { outline: none; }
								.D:hover { background: #eaeaea !important; }
								#newEventModal .buttons { margin-top: 20px; }
								.D .circular { position: absolute; bottom: 5px; right: 7px;}
		</style>
	</head>
	<body>
		<div id="calendar"></div>
		<div class="ui modal" id="newEventModal">
		  <div class="header">New event for <span></span></div>
		  <div class="content">
		  	<form class="ui form">
			  <div class="field">
			    <label>Name</label>
			    <input type="text" name="first-name" placeholder="Event Name..." id="newEventName">
			  </div>
			  <div class="field">
			    <label>Description</label>
			    <textarea rows="3" name="last-name" placeholder="Description..." id="newEventDescription"></textarea> 
			  </div>
			  <div class="field">
			  	<label>Members</label>
			  	<div id="membersInNewEvent"></div>
			  </div>
			  <div class="field inline">
			  	<div class="ui input">
				  <input type="text" placeholder="Member name" id="newMemberName">
				</div>
				<div class="ui labeled input">
				  <div class="ui label">
				    https://
				  </div>
				  <input type="text" placeholder="facebook.com" id="newMemberLink">
				</div>
				<div class="ui icon button" id="addMember">
				  <i class="add icon"></i>
				</div>
			  </div>
			</form>
			<div class="field">
				  <div class="ui buttons">
				  	<button class="ui button" id="cancel">Cancel</button>
				  	<div class="or"></div>
				  	<button class="ui positive button" id="saveEvent" data-tooltip="Enter name and description">Save</button>
				  </div>
			  </div>
		  </div>
		<div class="ui modal" id="eventModal">
		  <div class="header">Event for <span></span></div>
		  <div class="content">
			<div class="ui items">
			  <div class="item">
			    <div class="content">
			      <div class="header" id="eventName"></div>
			      <div class="description" id="eventDescrtiption"></div>
			    </div>
			  </div>
			</div>
			<div id="membersInEvent"></div>
			<button class="ui negative button" id="delete">
			  Delete event
			</button>
			<button class="ui button" id="close">
			  Close
			</button>
		  </div>
		</div>
		<script>
			var events = new Array();
			/* Calendar */
			class Calendar {
				constructor(element, locale, callback) {
					this.element = element;
					this.locale = locale;
					this.callback = callback;
					moment.locale(locale);
					this.show(moment().year());
				}
			
				show(year) {
					this.year = year;
					var m, d1, t = [], y = '', w = 0, r = 0, n = _.reduce(moment.weekdaysShort(), function(n, ddd) { return n += '<div class="ddd" data-ddd="' + ddd + '"></div>'; }, '');
					for (m = 0; m <= 11; m++) {
						var event = "";
						if (EventForDate(year + '-' + ('00' + (m + 1)).slice(-2) + '-01')) {
							event = '<div data-date="' + year + '-' + ('00' + (m + 1)).slice(-2) + '-01" class="ui teal empty tiny circular label"></div>';
						}
						d1 = moment([year, m, 1]);
						t.push('<div class="MMMM">' + moment.months()[m] + '</div>' + n + '<div class="MM"><a href="#" class="' + (year == moment().year() && m == moment().month() && 1 == moment().date() ? 'active ' : '') + 'D" data-d="' + d1.day() + '" data-date="' + year + '-' + ('00' + (m + 1)).slice(-2) + '-01" draggable="false"><span class="num" data-date="' + year + '-' + ('00' + (m + 1)).slice(-2) + '-01">1</span>' + event + '</a>' + _.range(2, d1.daysInMonth() + 1).reduce(function(MM, d) { 
							var event = "";
							if (EventForDate(year + '-' + ('00' + (m + 1)).slice(-2) + '-' + ('00' + d).slice(-2))) {
								event = '<div data-date="' + year + '-' + ('00' + (m + 1)).slice(-2) + '-' + ('00' + d).slice(-2) + '" class="ui teal empty tiny circular label"></div>';
							}
							return MM += '<a href="#" class="' + (year == moment().year() && m == moment().month() && d == moment().date() ? 'active ' : '') + 'D" data-date="' + year + '-' + ('00' + (m + 1)).slice(-2) + '-' + ('00' + d).slice(-2) + '" draggable="false">' + '<span class="num" data-date="' + year + '-' + ('00' + (m + 1)).slice(-2) + '-' + ('00' + d).slice(-2) + '">' + d + '</span>' + event + '</a>'; }, '') + '</div>');
						w = Math.max(w, Math.ceil((d1.day() + d1.daysInMonth()) / 7));
						if (m == 3 || m == 7 || m == 11) {
							y += '<div class="M" data-w="' + w + '">' + t.join('</div><div class="M" data-w="' + w + '">') + '</div>';
							r += w;
							w = 0;
							t = [];
						}
					}
					this.element.innerHTML = '<nav><a href="#" class="nav prev" draggable="false"><svg viewBox="0 0 512 512"><path d="M189.8,349.7c3.1-3.1,3-8,0-11.3L123.4,264H408c4.4,0,8-3.6,8-8c0-4.4-3.6-8-8-8H123.4l66.3-74.4c2.9-3.4,3.2-8.1,0.1-11.2c-3.1-3.1-8.5-3.3-11.4-0.1c0,0-79.2,87-80,88S96,253.1,96,256s1.6,4.9,2.4,5.7s80,88,80,88c1.5,1.5,3.6,2.3,5.7,2.3C186.2,352,188.2,351.2,189.8,349.7z"/></svg></a><div class="title"><strong>' + year + '</strong></div><a href="#" class="nav next" draggable="false"><svg viewBox="0 0 512 512"><path d="M322.2,349.7c-3.1-3.1-3-8,0-11.3l66.4-74.4H104c-4.4,0-8-3.6-8-8c0-4.4,3.6-8,8-8h284.6l-66.3-74.4c-2.9-3.4-3.2-8.1-0.1-11.2c3.1-3.1,8.5-3.3,11.4-0.1c0,0,79.2,87,80,88s2.4,2.8,2.4,5.7s-1.6,4.9-2.4,5.7s-80,88-80,88c-1.5,1.5-3.6,2.3-5.7,2.3C325.8,352,323.8,351.2,322.2,349.7z"/></svg></a></nav><div class="YYYY" data-w="' + r + '">' + y + '</div>';
					this.element.querySelector('.prev').addEventListener('click', () => { this.show(--this.year); });
					this.element.querySelector('.next').addEventListener('click', () => { this.show(++this.year); });
					this.element.querySelectorAll('.D').forEach((element) => element.addEventListener('click', (event) => { this.callback(event.target.getAttribute('data-date')); }));
					$(".D").popup('destroy');
					$(".D").each(function(){
						var event = EventForDate($(this).data("date"));
						if(event == null) {
							$(this).popup({
								content: "Add event",
								position: "bottom center"
							});
						} else {
							$(this).popup({
								title: event.Name,
								position: "bottom center"
							});
						}
					});
				}
			}

			class Member {
				constructor(name, link) {
					this.name = name;
					this.link = link;
				}

				get Name() {
					return this.name;
				}

				get Link() {
					return this.link;
				}
			}


			class Event {
				constructor() {
					this.members = new Array();
				}

				get Date() {
					return this.date;
				}

				set Date(value) {
					this.date = value;
				}

				get Name() {
					return this.name;
				}

				set Name(value) {
					this.name = value;
				}

				get Description() {
					return this.description;
				}

				set Description(value) {
					this.description = value;
				}
				AddMember(member) {
					this.members.push(member);
				}
			}
			
			calendar = new Calendar(document.getElementById('calendar'), 'en', function(date) {
				var event = EventForDate(date);
				if (event == null) {
					$("#newEventName").val("");
					$("#newEventDescription").val("");
					$("#newMemberName").val("");
					$("#newMemberLink").val("");
					$("#membersInNewEvent").empty();
					$("#newEventModal").data("date", date);
					$("#newEventModal .header span").text(moment(date).format("Mo MMMM, YYYY"));
					$("#newEventModal").modal({
						blurring: true
					}).modal('show');
				} else {
					$("#eventModal").data("date", event.Date);
					$("#eventName").text(event.Name);
					$("#eventDescrtiption").text(event.Description);
					event.members.forEach(function(item, i, array){
						$("#membersInEvent").append('<a class="ui image label member"><img src="https:\\semantic-ui.com/images/avatar/small/joe.jpg">' + item.Name + '</a>');
					});
					$("#eventModal").modal({
						blurring: true
					}).modal('show');			
				}
			});

			function EventForDate(date) {
				var result = $.grep(events, function(item, i){
					return item.Date == date;
				});
				if (result.length > 0) {
					return result[0];
				} else {
					return null;
				}
			}

			function AddNewEvent() {
				var newEvent = new Event();
				var date = $("#newEventModal").data("date");
				newEvent.Date = date;
				newEvent.Name = $("#newEventName").val();
				newEvent.Description = $("#newEventDescription").val();
				$("#membersInNewEvent .member").each(function(){
					var member = new Member($(this).data("name"), $(this).data("link"));
					newEvent.AddMember(member);
				});
				events.push(newEvent);
				calendar.show(calendar.year);
				$("#newEventModal").modal('hide');
			}

			$("#addMember").on('click', function(){
				var member_name = $("#newMemberName").val();
				var member_link = $("#newMemberLink").val();
				$("#membersInNewEvent").append('<div data-name="' + member_name + '" data-link="' + member_link + '" class="member ui image label"><img src="https:\\semantic-ui.com/images/avatar/small/ade.jpg">' + member_name + '<i class="delete icon"></i></div>');
			});
			$(document).on('click', '.delete', function(){
				$(this).parent().remove();
			});
			$("#cancel").on('click', function(){
				$('#newEventModal').modal('hide');
			});
			$("#saveEvent").on('click', function(){
				if ($("#newEventName").val().length > 1 && $("#newEventDescription").val().length > 1) {
					AddNewEvent();
				}
			});
		</script>
	</body>
</html>